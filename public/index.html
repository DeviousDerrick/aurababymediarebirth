<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AuraBaby Media</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Poppins', sans-serif; background: #000; color: #fff; }
    header { display: flex; align-items: center; justify-content: space-between; padding: 18px 22px; background: #0a0a0a; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #111; }
    header h1 { font-weight: 800; font-size: 24px; margin: 0; }
    header h1 span { color: #7c7cff; text-shadow: 0 0 12px rgba(124,124,255,0.6); }
    header input { background: #111; border: none; color: white; padding: 10px 14px; border-radius: 10px; width: 220px; outline: none; font-size: 14px; }

    #tabs { display: flex; justify-content: center; gap: 16px; background: #0a0a0a; padding: 10px 0; border-bottom: 1px solid #111; }
    #tabs .tab { background: #111; color: #fff; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 700; transition: 0.2s; }
    #tabs .tab.active { background: #7c7cff; color: #000; box-shadow: 0 0 12px rgba(124,124,255,0.6); }

    main { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 16px; padding: 20px; }
    .movie { cursor: pointer; }
    .movie img { width: 100%; display: block; background: #000; }
    .movie-info { padding: 10px; }
    .movie-info h3 { font-size: 14px; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .movie-info span { font-size: 12px; opacity: 0.7; }
    .movie:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(124,124,255,0.25); }
  </style>
</head>
<body>
  <header>
    <h1>AuraBaby <span>Media</span></h1>
    <input id="search" type="text" placeholder="Search..." />
  </header>

  <nav id="tabs">
    <button class="tab active" data-type="movie">Movies</button>
    <button class="tab" data-type="tv">Shows</button>
  </nav>

  <main id="movies"></main>

  <script>
    const API_KEY = "72f0a0fa086259c4fc4b8bf0b856e446";
    const BASE_URL = "https://api.themoviedb.org/3";
    const IMG_URL = "https://image.tmdb.org/t/p/w500";

    const moviesEl = document.getElementById("movies");
    const searchInput = document.getElementById("search");
    const tabs = document.querySelectorAll("#tabs .tab");
    let currentType = "movie";

    // Load popular items on start
    getItems(`${BASE_URL}/movie/popular?api_key=${API_KEY}`);

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        currentType = tab.dataset.type;
        searchInput.value = "";
        getItems(`${BASE_URL}/${currentType}/popular?api_key=${API_KEY}`);
      });
    });

    searchInput.addEventListener("input", e => {
      const query = e.target.value.trim();
      if (!query) {
        getItems(`${BASE_URL}/${currentType}/popular?api_key=${API_KEY}`);
        return;
      }
      getItems(`${BASE_URL}/search/${currentType}?api_key=${API_KEY}&query=${encodeURIComponent(query)}`);
    });

    async function getItems(url) {
      try {
        const res = await fetch(url);
        const data = await res.json();
        showItems(data.results);
      } catch {
        moviesEl.innerHTML = "<p style='color:red'>Failed to load content.</p>";
      }
    }

    async function showItems(items) {
      moviesEl.innerHTML = "";
      for (const item of items) {
        const movieEl = document.createElement("div");
        movieEl.className = "movie";

        const id = item.id;
        const title = encodeURIComponent(item.title || item.name);

        movieEl.innerHTML = `
          <img src="${item.poster_path ? IMG_URL + item.poster_path : ''}" alt="${item.title || item.name}">
          <div class="movie-info">
            <h3>${item.title || item.name}</h3>
            <span>‚≠ê ${item.vote_average}</span>
          </div>
        `;

        movieEl.addEventListener("click", async () => {
          let type = currentType;
          let season = 1, episode = 1;
          const url = `/tvplayer.html?id=${id}&title=${title}&type=${type}&season=${season}&episode=${episode}`;
          // Encode via Project Ocho
          const resp = await fetch(`/api/encode?url=${encodeURIComponent(url)}`);
          const data = await resp.json();
          if (data.proxyUrl) window.location.href = data.proxyUrl;
          else window.location.href = url;
        });

        moviesEl.appendChild(movieEl);
      }
    }
  </script>
</body>
</html>
